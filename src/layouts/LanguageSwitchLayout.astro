---
/**
 * 言語切り替えレイアウト - 言語検出とリダイレクト
 *
 * Accept-Languageヘッダーを確認し、適切な言語ページにリダイレクト。
 * SSRが必要な場合はクライアントサイドで処理。
 */

interface Props {
  targetPath: string;
  availableLanguages?: ('en' | 'ja')[];
  defaultLanguage?: 'en' | 'ja';
}

const {
  targetPath,
  availableLanguages = ['en', 'ja'],
  defaultLanguage = 'en',
} = Astro.props;
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vivliostyle Documentation</title>
  <meta name="robots" content="noindex">
  <link rel="canonical" href={`${Astro.url.origin}/${defaultLanguage}${targetPath}`}>
  <link rel="stylesheet" href="/styles/global.css">
  <script data-target-path={targetPath} data-supported-languages={availableLanguages.join(',')} data-default-language={defaultLanguage}>
    // 言語検出とリダイレクト
    (function() {
      const supportedLangs = document.currentScript.getAttribute('data-supported-languages').split(',');
      const defaultLang = document.currentScript.getAttribute('data-default-language');

      // ブラウザの言語設定を取得
      const browserLang = navigator.language || '';
      const langCode = browserLang.split('-')[0].toLowerCase();

      // サポートされている言語かチェック
      const targetLang = supportedLangs.includes(langCode) ? langCode : defaultLang;

      // リダイレクト
      const targetPath = document.currentScript.getAttribute('data-target-path');
      window.location.replace(`/${targetLang}${targetPath}`);
    })();
  </script>
  <noscript>
    <meta http-equiv="refresh" content={`0; url=/${defaultLanguage}${targetPath}`}>
  </noscript>
</head>
<body>
  <noscript>
    <meta http-equiv="refresh" content={`0; url=/${defaultLanguage}${targetPath}`}>
  </noscript>
  <p style="font-size: 0">Welcome to the documentation. Please navigate to <a href={`/${defaultLanguage}${targetPath}`}>English documentation</a>.</p>
</body>
</html>
