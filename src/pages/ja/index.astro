---
/**
 * 日本語版トップページ
 */
import DocsLayout from '../../layouts/DocsLayout.astro';
import LanguageSwitcher from '../../components/LanguageSwitcher.astro';
import { getCollection } from 'astro:content';

// VFMでコンバートされたドキュメントを取得
let indexDoc = null;
let htmlContent = '';

try {
  const docs = await getCollection('docs-ja');
  indexDoc = docs.find(doc => doc.id === 'ja/index' || doc.id.endsWith('/index') || doc.id === 'index');
  
  if (indexDoc && indexDoc.rendered) {
    htmlContent = indexDoc.rendered.html;
  }
} catch (error) {
  console.error('Failed to load docs:', error);
}

const title = indexDoc?.data?.title || 'Vivliostyle ドキュメントへようこそ';
const description = indexDoc?.data?.description || 'Vivliostyle公式ドキュメント';
---

<DocsLayout title={title} description={description} lang="ja">
  <LanguageSwitcher slot="header" currentLang="ja" pagePath="/" hasTranslation={true} />
  <nav slot="sidebar">
    <h3>ドキュメント</h3>
    <ul style="list-style: none; padding-left: 0;">
      <li><a href="/ja/">ホーム</a></li>
      <li><a href="/ja/viewer/">Vivliostyle Viewer</a></li>
      <li><a href="/ja/cli/">Vivliostyle CLI</a></li>
      <li><a href="/ja/vfm/">VFM</a></li>
      <li><a href="/ja/themes/">Vivliostyle Themes</a></li>
      <li><a href="/ja/reference/">リファレンス</a></li>
    </ul>
  </nav>

  {htmlContent ? (
    <Fragment set:html={htmlContent} />
  ) : (
    <article>
      <h1>Vivliostyle ドキュメントへようこそ</h1>
      <p>ドキュメントを読み込み中...</p>
      <p>このメッセージが表示される場合、VFMローダーがまだコンテンツを処理していない可能性があります。</p>
    </article>
  )}
</DocsLayout>
